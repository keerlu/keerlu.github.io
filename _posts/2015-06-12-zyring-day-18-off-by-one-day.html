---
layout: post
title: Zyring Day 18 - Off By One Day
date: 2015-06-12 13:52:34.000000000 +01:00
categories: []
tags:
- Angular
- JavaScript
- Zyring
status: publish
type: post
published: true
meta:
  _wpcom_is_markdown: '1'
  _rest_api_published: '1'
  _rest_api_client_id: '-1'
  _publicize_job_id: '11599714278'
author:
  login: wotidun
  email: wotidunread@gmail.com
  display_name: wotidun
  first_name: ''
  last_name: ''
excerpt: !ruby/object:Hpricot::Doc
  options: {}
---
<p><em>[Note: These are more in-depth (read: tedious) write-ups of my experience with each section of the Zyring project, leading on from my <a href="https://wotidun.wordpress.com/2015/04/14/wot-i-dun-zyring-project/">intro post</a> on Zyring. This is mostly for my own benefit but could conceivably be of use to someone doing the project.]</em></p>
<h2>Using the pager element to navigate (cont'd)</h2>
<p>OK, I'm awake, reasonably alert, and well-fortified by the supermarket garlic naan I ate cold out of the bag on a bench in the shopping centre. Apparently this is not what the well-dressed ladies of Clifton generally do for breakfast, or so I gather from the odd looks, but hopefully it's helped put me in the right frame of mind for going back and looking at the off-by-one error I had <a href="https://wotidun.wordpress.com/2015/05/27/zyring-day-12-notes-from-ages-ago/">weeks ago</a>.</p>
<p>First, let's work out exactly what the problem is. Take Seattle as an example. There are 165 apartments listed, so that should make 18 pages of 9 apartments plus a 19th page with 3 apartments. Looking at the backend data, the first apartment on each page should be:</p>
<p>Page 1: Avalon Kirkland<br />
Page 2: Kerry Park Apartments<br />
Page 3: Lexicon<br />
...<br />
Page 17: The Dakota at Rainier Court<br />
Page 18: The Century<br />
Page 19: Alcyone</p>
<p>However what's actually happening is this:</p>
<ul>
<li>On first loading <code>cities/Seattle</code>, I get Avalon Kirkland as expected.</li>
<li>But if I now click on page 2, I get Lexicon which should be page 3...</li>
<li>...and if I click back to 1 I get Kerry Park Apartments. :(</li>
<li>Also, the list of pages only goes up to 17, The Dakota. The pages above that are just not displayed.</li>
</ul>
<p>Same stuff if I click on 'Next' and 'Previous' instead of the page numbers. So I'm initialising it correctly, which makes sense as I'm explicitly setting <code>$scope.currentPage = 0;</code>, but then it's off by one after that. Not sure what's going on with the last pages missing.</p>
<p>Looking at the <a href="https://angular-ui.github.io/bootstrap/">AngularUI Bootstrap documentation</a>, I see that <code>ng-model</code> expects the first page to be 1, whereas mine start at 0, so that is one of the problems, so I fix that. After fixing this Avalon Kirkland is consistently the first page as expected, which is good, but I now have a "TypeError: Cannot read property 'push' of undefined" message, and the pager element loads stuck on page 17, which is still the last page. So I've fixed one thing and now something else is broken - progress of a sort.</p>
<p>OK, now I'm having a look at the array of pages <code>$scope.pages</code>. It looks OK before I push any information into it, but then there's a problem. It should look like <code>[Array[9], Array[9], Array[9],...]</code> but instead there's an <code>Array[0]</code> at the beginning. Bummer. This might explain why I'm getting the 'TypeError' message, though, as there isn't enough space in the array for everything I want to push to it, so I'm making progress.</p>
<p>Indeed, I find my <code>while</code> loop goes one too high, and I get rid of the TypeError problem and the carousel loads at the first page with Avalon Kirkland as expected. STILL having the problem with the highest pages missing though.</p>
<p>Let's look at all the cities...</p>
<ul>
<li>Seattle: 165 apartments, should be 19 pages, displaying 17, out by -2</li>
<li>Redmond: 65 apartments, should be 8 pages, displaying 7, out by -1</li>
<li>Bellevue: 164 apartments, should be 19 pages, displaying 17, out by -2</li>
<li>Kirkland: 172 apartments, should be 20 pages, displaying 18, out by -2</li>
<li>Tacoma: 141 apartments, should be 16 pages, displaying 15, out by -1</li>
<li>Olympia: 52 apartments, should be 6 pages, displaying 6, correct</li>
</ul>
<p>So it seems to be more wrong the larger the number of apartments, but why is not obvious to me.</p>
<p>I also find another problem, possibly related. When I click on some apartments, the data doesn't load. Instead I get an empty page like this:</p>

<figure>
    <img src='/assets/empty_page.png' alt="Page with no data loaded" />
    <figcaption>Not very helpful</figcaption>
</figure>

<p>This happens only with apartments on later pages.</p>
<p>I fiddle about with this all day but cannot work out what the problem is. It might finally be time to ask for help... but I want to finish off the remaining bits of styling first.</p>


